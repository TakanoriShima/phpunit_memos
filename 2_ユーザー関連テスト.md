# 2_ユーザー関連テスト

<p style='text-align: right;'> &copy; 20220105 by Takanori Shima </p>

```
* 以下、Cloud9上でターミナルを起動してコマンドを打つ *
最終的には3つのターミナルを同時に開いておく
- MySQL用(占有)
- Laravelサーバ起動用(占有)
- artisanコマンドを随時実行用
```

## 1. testsフォルダにあるデフォルトのテストケース確認
#### tests/Feature/ExampleTest.php（機能テスト）
```
<?php

namespace Tests\Feature;

use Tests\TestCase;
use Illuminate\Foundation\Testing\RefreshDatabase;

class ExampleTest extends TestCase
{
    /**
     * A basic test example.
     *
     * @return void
     */
    public function testBasicTest()
    {
        $response = $this->get('/');

        $response->assertStatus(200);
    }
}

```

#### tests/Unit/ExampleTest.php（ユニットテスト）
```
<?php

namespace Tests\Unit;

use Tests\TestCase;
use Illuminate\Foundation\Testing\RefreshDatabase;

class ExampleTest extends TestCase
{
    /**
     * A basic test example.
     *
     * @return void
     */
    public function testBasicTest()
    {
        $this->assertTrue(true);
    }
}
```
## 2. デフォルトのテストケースを実行

```
vendor/bin/phpunit

PHPUnit 7.5.20 by Sebastian Bergmann and contributors.

..                                                                  2 / 2 (100%)

Time: 179 ms, Memory: 18.00 MB

OK (2 tests, 2 assertions)
```

## 3. 上記2つのテストケースファイルを手動で削除し、再度テスト実行
```
vendor/bin/phpunit
PHPUnit 7.5.20 by Sebastian Bergmann and contributors.

Time: 27 ms, Memory: 6.00 MB

No tests executed!
```


## 4. Unitディレクトリに新しいテストケースを作成
```
php artisan make:test UserTest --unit
```
#### tests/Unit/UserTest.phpの内容を確認
```
<?php

namespace Tests\Unit;

use Tests\TestCase;
use Illuminate\Foundation\Testing\WithFaker;
use Illuminate\Foundation\Testing\RefreshDatabase;

class UserTest extends TestCase
{
    /**
     * A basic unit test example.
     *
     * @return void
     */
    public function testExample()
    {
        $this->assertTrue(true);
    }
}

```

新規ユーザーが登録できるかテストするメソッドを記述。以下に書き換える
```
<?php

namespace Tests\Unit;

use Tests\TestCase;
use Illuminate\Foundation\Testing\WithFaker;
use Illuminate\Foundation\Testing\RefreshDatabase;
use App\User; // 追加

class UserTest extends TestCase
{

    /**
     * 複数のテストで使用するような値を事前に定義
     *
     * @return void
     */
    public function setUp() :void
    {
        parent::setUp();
    }

    /**
     * 新規ユーザー登録テスト
     *
     * @return void
     */
    public function test_新規ユーザー登録()
    {
        // 新規ユーザー情報の設定
        $attributes = [
            'name'     => 'test',
            'email'     => 'test@example.com',
            'password' => bcrypt('test'),
        ];
        // 新規ユーザーのDBへの登録
        User::create($attributes);
        // 登録した情報がusersテーブルに保存されているかの確認
        $this->assertDatabaseHas('users', $attributes);
    }

}

```

## 5. ユニットテスト実行
```
vendor/bin/phpunit   
PHPUnit 7.5.20 by Sebastian Bergmann and contributors.

.                                                                   1 / 1 (100%)

Time: 120 ms, Memory: 16.00 MB

OK (1 test, 1 assertion)
```

MySQLのlaravel_testデータベースに新規テストユーザーが登録されていることを確認
```
mysql> select * from users;
+----+------+------------------+-------------------+--------------------------------------------------------------+----------------+---------------------+---------------------+
| id | name | email            | email_verified_at | password                                                     | remember_token | created_at          | updated_at          |
+----+------+------------------+-------------------+--------------------------------------------------------------+----------------+---------------------+---------------------+
|  1 | test | test@example.com | NULL              | $2y$04$fdHrMmIAtGBNqyqboeOkLOacoWL1wevAvqrM9DpCpJi.jiKVGvtv. | NULL           | 2022-01-05 11:07:58 | 2022-01-05 11:07:58 |
+----+------+------------------+-------------------+--------------------------------------------------------------+----------------+---------------------+---------------------+
1 row in set (0.00 sec)
```

## 6. ユニットテスト再実行
同じメールアドレスではユーザー登録できないのでエラーになる
```
vendor/bin/phpunit
PHPUnit 7.5.20 by Sebastian Bergmann and contributors.

E                                                                   1 / 1 (100%)

Time: 607 ms, Memory: 16.00 MB

There was 1 error:

1) Tests\Unit\UserTest::test_store
Illuminate\Database\QueryException: SQLSTATE[23000]: Integrity constraint violation: 1062 Duplicate entry 'test@example.com' for key 'users_email_unique' (SQL: insert into `users` (`name`, `email`, `password`, `updated_at`, `created_at`) values (test, test@example.com, $2y$04$WVJXkpGPCv6uU308iIMaE.nmvIojOWv5oYKuTWZ3tQ8NQqzWQxPGy, 2022-01-05 11:12:37, 2022-01-05 11:12:37))
...
```
#### tests/Unit/UserTest.phpを以下のように変更し、テスト実行後毎回テーブルをリフレッシュ（空に戻す）するようにする。

```
<?php

namespace Tests\Unit;

use Tests\TestCase;
use Illuminate\Foundation\Testing\WithFaker;
use Illuminate\Foundation\Testing\RefreshDatabase;
use App\User; // 追加

class UserTest extends TestCase
{

    // テストが終わったらテーブルをリフレッシュする設定
    use RefreshDatabase;
    
    /**
     * 複数のテストで使用するような値を事前に定義
     *
     * @return void
     */
    public function setUp() :void
    {
        parent::setUp();
    }

    /**
     * 新規ユーザー登録テスト
     *
     * @return void
     */
    public function test_新規ユーザー登録()
    {
        // 新規ユーザー情報の設定
        $attributes = [
            'name'     => 'test',
            'email'     => 'test@example.com',
            'password' => bcrypt('test'),
        ];
        // 新規ユーザーのDBへの登録
        User::create($attributes);
        // 登録した情報がusersテーブルに保存されているかの確認
        $this->assertDatabaseHas('users', $attributes);
    }

}
```

この場合、何回連続してテストを実行してもエラーは出ないようになる。
ただし内部では delete処理をしているため 消えたidは永久欠番になる。

## 7. fakerを使ったダミーユーザー登録
MySQLのusersテーブルの情報を一旦削除し、自動連番を1に戻す。
```
mysql> delete from users;
mysql> alter table users auto_increment=1;
```

#### config/app.php の 109行目附近を書き換えてfakerを日本語化する
```
    'faker_locale' => 'ja_JP',
```

一旦設定をクリア
```
php artisan config:clear
```

#### tests/Unit/UserTest.phpを以下に書き換え。100件のダミーユーザーが正常に登録できるか確認
```
<?php

namespace Tests\Unit;

use Tests\TestCase;
// use Illuminate\Foundation\Testing\WithFaker;
use Illuminate\Foundation\Testing\RefreshDatabase;
use App\User; // 追加
use Faker\Factory; // 追加

class UserTest extends TestCase
{

    // テストが終わったらテーブルをリフレッシュする設定
    // use RefreshDatabase;
    
    /**
     * 複数のテストで使用するような値を事前に定義
     *
     * @return void
     */
    public function setUp() :void
    {
        parent::setUp();
        // faker を初期化
        $this->faker = Factory::create('ja_JP');
    }

    /**
     * 新規ユーザー登録テスト
     *
     * @return void
     */
    public function test_新規ユーザー登録()
    {
        // 挿入するデータ件数を定義
        $num = 100;
        
        // 現状のユーザー数をカウント
        $count_before = count(User::all());
        
        // fakerを使って100データを挿入
        for($i = 1; $i <= $num; $i++){
            // faker を使ってダミーユーザー情報を作成
            $attributes = [
                'name'     => $this->faker->name,
                'email'     => $this->faker->unique()->email,
                'password' => bcrypt($this->faker->password),
            ];
            // 新規ユーザーのDBへの登録
            User::create($attributes);
            // 挿入されたデータが確かにusersテーブルに存在するか確認
            $this->assertDatabaseHas('users', $attributes);
        }
        
        // 100データ挿入後の全ユーザー数をカウント
        $count_after = count(User::all());
        
        // 100データ増えているか確認
        $this->assertSame(($count_before + $num), $count_after);
    }

}


```

テスト実行
```
vendor/bin/phpunit
PHPUnit 7.5.20 by Sebastian Bergmann and contributors.

.                                                                   1 / 1 (100%)

Time: 563 ms, Memory: 18.00 MB

OK (1 test, 101 assertions)
```

MySQLでデータ確認
```
mysql> select * from users;                                                                                                                                                                                             
+-----+---------------------+---------------------------------+-------------------+--------------------------------------------------------------+----------------+---------------------+---------------------+
| id  | name                | email                           | email_verified_at | password                                                     | remember_token | created_at          | updated_at          |
+-----+---------------------+---------------------------------+-------------------+--------------------------------------------------------------+----------------+---------------------+---------------------+
|   1 | 青田 聡太郎         | xaota@saito.com                 | NULL              | $2y$04$07dILz9bAyiB//2Vo.5EmOdS/xkSSmBrZU6.l91vo7sE/UDSCkQFK | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|   2 | 中島 聡太郎         | nakatsugawa.rei@hotmail.co.jp   | NULL              | $2y$04$gg/pdTgh/1Fq7al/Ndd/sOAeL3q/CwUCdanMn53GR34buG.uJfG0G | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|   3 | 野村 健一           | ttanaka@sasaki.jp               | NULL              | $2y$04$Qmq50c/1VVlJeQif1Bj9U.eHcR4ehH/2DR7TfwRprBJMYRKDrpzoq | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|   4 | 吉本 治             | hiroshi.yamada@gmail.com        | NULL              | $2y$04$Vz02.VVfIYST6sI.RYJmY.Vqy0lOeNz8ARJquCo3DKK3IaCSKBcnS | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|   5 | 中島 零             | mikako.murayama@mail.goo.ne.jp  | NULL              | $2y$04$xG0yrbVEsOFBJrZ6Sdhj1.ZEUqQicOX1L8QpC0UlaBkRLreRlb8l2 | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|   6 | 加藤 春香           | maaya.aoyama@miyazawa.net       | NULL              | $2y$04$BZeAxrV7YzjPXQ76u2a8J.AUBlPmlHCFtK11.zQFMK/tQZ/xRppOO | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|   7 | 津田 桃子           | nishinosono.soutaro@yahoo.co.jp | NULL              | $2y$04$i5rYsNTlx/5rmrJFrVq5aOr7xgqCJvAbiRqM3IunBKzCPofJODY4e | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|   8 | 渡辺 真綾           | qwatanabe@hotmail.co.jp         | NULL              | $2y$04$KnxcZrz2KaitbFKGO62s5un1bIHRky5o3y048p5kjfP8upwPW0o8C | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|   9 | 吉本 幹             | qmatsumoto@hotmail.co.jp        | NULL              | $2y$04$C2TSAalpRo99gGxcfb.mbuKfDO2q7qpZE6E/ENaUkOcK.k4JZwekK | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  10 | 渚 京助             | yosuke.yoshida@kato.jp          | NULL              | $2y$04$EtSHCbJe6sZZJWYL4WW6ju14BMgeRuW497wq/XhNP9CnOuWm/GblG | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  11 | 小泉 さゆり         | jsaito@kudo.net                 | NULL              | $2y$04$dSCChA3vQ3L1bG3nlBATsejg2JZfz9KF1FHL5A05s9w48ZX8zhdFe | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  12 | 田中 太一           | hideki19@hotmail.co.jp          | NULL              | $2y$04$8AKMzj0RW45T/z7yiTTvo.Yi6ybITy/amj.xX2/ZmsRAabeJosARu | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  13 | 三宅 浩             | anagisa@yahoo.co.jp             | NULL              | $2y$04$B/PlzyB4qEb3mWwzV2xUmOWddXN1LjLuWvCrXh98dG53RYR9vvSrW | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  14 | 村山 拓真           | soutaro21@mail.goo.ne.jp        | NULL              | $2y$04$xc0Ab/jSpVdh2o5.7T5hbuhQtzVcGwucwWECcKlHSFw.yF8quZ1Hm | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  15 | 井高 太一           | zsugiyama@hotmail.co.jp         | NULL              | $2y$04$ppdl2sge6zKDiZz8rqyz0e3Y3l1x1.nF7mqhEnieDiE.9pruLP.vC | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  16 | 田辺 翼             | maaya24@mail.goo.ne.jp          | NULL              | $2y$04$OLgrxAbHqrNYpGv.YxA9EOaZTscrila9H9Y8EQqhw2DCUcjCPqLJW | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  17 | 田辺 舞             | kijima.rika@sato.jp             | NULL              | $2y$04$W8MJx7fgC0TpSJ/WDXe6k.msnocTnaX1Z9ZTU1CEbmkF6aLZWcvTu | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  18 | 桐山 直子           | yoko.sugiyama@mail.goo.ne.jp    | NULL              | $2y$04$mIMNuywFBggYRbZcnlcC7.0cVhx4sK0VCYE.OEmZdB7eZXlS0rm7q | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  19 | 桐山 加奈           | skoizumi@tsuda.org              | NULL              | $2y$04$DgmK7BtmwkYRJ5SUo8RHKes2FIywxDqsVpFRY5Wzh1SPKOVggiFnm | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  20 | 山岸 翼             | mnomura@yahoo.co.jp             | NULL              | $2y$04$SbFKFcoW6wX3ioHvriSstefoR8ODrsaQJNcvInXDk90GLMLj8YE2W | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  21 | 佐藤 陽子           | tomoya55@hotmail.co.jp          | NULL              | $2y$04$Zsz6QpGSKRGfdsF3TkqL5.Ixlabr6iYWKXzZ9pmV3MELb2kEoafHO | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  22 | 佐藤 拓真           | taro47@hotmail.co.jp            | NULL              | $2y$04$MzMcWKA7J9/ria7S0Euwte..pLwLb4QrZYQNjAKSsD4QMM3y80wBG | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  23 | 村山 洋介           | idaka.taichi@yahoo.co.jp        | NULL              | $2y$04$8huUgiz8bOKLTScBAvu/heExgH7LixNhhwLKJOgSE9btLBAPLQHmi | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  24 | 石田 翔太           | sato.naoki@yamagishi.com        | NULL              | $2y$04$ZCikTlSy.cRopX2hduqtvu5GCbf4VV8bRGB7UDalAlxUNfyYS8UGK | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  25 | 浜田 明美           | sakamoto.yuta@harada.jp         | NULL              | $2y$04$jZjZRVUn7pWgk/kGByFwQuJSllPhJpGka6z92icZDTJdYwJYjwY5y | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  26 | 近藤 洋介           | minoru.yamagishi@mail.goo.ne.jp | NULL              | $2y$04$9f/SyVffrknM8OaGWuE3Vego/M.2euGp9QByw5JTzIgR47ylFxZh6 | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  27 | 宮沢 幹             | momoko40@gmail.com              | NULL              | $2y$04$l0Q5BbI/k/EaFL4/5zSVg.nhHNuR38NidKxCtEQVr34ef1f44syM. | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  28 | 宇野 拓真           | akemi.ogaki@nakamura.info       | NULL              | $2y$04$wBU.kZJOPM.MH0cWuLwB2e9toDZZ9k/IpIyXQdo4nQRgrE2fIj2YG | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  29 | 井上 直子           | osamu99@saito.info              | NULL              | $2y$04$xOqF44MPuPXMJ.gDyWIPM.Tj5SV.lZYQX4ClN8irCXKGV6PbOFHHS | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  30 | 渚 翼               | yuki.koizumi@saito.biz          | NULL              | $2y$04$SMJxSDt2ye33PWBoE.xxYuOP.irsnzARiOE/an/jN2dCXniZ/wmOK | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  31 | 津田 裕太           | ewakamatsu@gmail.com            | NULL              | $2y$04$JvetKqUxqPFCPjf13MuKmuDu4.S5E6LQFoW1MfqslRbN9TFFZN6.2 | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  32 | 原田 太一           | emurayama@kudo.jp               | NULL              | $2y$04$nMJp66rZBKQmBHws1RrofOh90OJ.00TjiyDXMi6.N3qucj/CMqS0m | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  33 | 工藤 里佳           | aidaka@yahoo.co.jp              | NULL              | $2y$04$EuT4b4XbcALLTEMYgl3ddODdiMXzjFUGLrAGMFMJq3pltRHr3QDYi | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  34 | 田中 太郎           | yuki30@murayama.jp              | NULL              | $2y$04$3HVQAxwZCWSWoEMlrY9xSeyzQ8Ui8pjNPrDJ.VlmPllOsxh91TuQ6 | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  35 | 江古田 治           | shota.saito@kondo.info          | NULL              | $2y$04$UXKSpWBBdY.8b/lXMffs6eMkU.oCC8HU1r/jPIdSLpWB8.XfUZv42 | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  36 | 佐藤 陽子           | yamagishi.haruka@watanabe.com   | NULL              | $2y$04$Jz6ruMzZUg/7FuC7HZcD4uVO.XPts1RgjA4Tl1vDvDjOXBChOTOza | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  37 | 斉藤 明美           | ogaki.atsushi@yahoo.co.jp       | NULL              | $2y$04$IIFVyJpjr/1BoUy6uXvy3eYfDeYnnIVq5TdR4o3PECpbksFlmB5/. | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  38 | 原田 幹             | takahashi.shota@mail.goo.ne.jp  | NULL              | $2y$04$nFqOxYzuKmYm54zeENmvYeUL319fLLsHpqDEVh18xgafqecBR/s/G | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  39 | 山口 千代           | kudo.maaya@miyake.com           | NULL              | $2y$04$ec2RXNPIauhhTT0d9ckP.u6qPXohqW6tYq0Lkn.Lc6epEG22Haycu | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  40 | 野村 涼平           | psakamoto@hotmail.co.jp         | NULL              | $2y$04$R8ihw4Itfw5ywK6SlnAqXOr9YzgNxludyjWrI71k/loja19nF5aOG | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  41 | 加藤 智也           | haruka45@yamamoto.org           | NULL              | $2y$04$CmPJ5CNI8zUQgHt5kk5r.Oe2FGaHAqnWtxvt6Kqa.hNT.9JS7Dcoa | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  42 | 斉藤 加奈           | naoko62@koizumi.org             | NULL              | $2y$04$frjnPjNNlYb.erWaOGW1g.snYz0MdQwvfjZdjpm5KUVVtY6flk3l6 | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  43 | 浜田 直人           | yuta.nakajima@gmail.com         | NULL              | $2y$04$4mjjcTjYWHIyaLGyjUPsCeni9gM1F0Do.lLs0EbWBW/sxMCNN86p2 | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  44 | 宇野 浩             | takuma32@uno.org                | NULL              | $2y$04$rfVwnlEL6uljld74VrrEwOdPFB3sef6I7nG/FQdtf8QLQVvo3DvQy | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  45 | 加藤 稔             | maaya.yoshida@hotmail.co.jp     | NULL              | $2y$04$6bf9lIuIwiYpYPEJ1RvAvOfSfqP5rxJpqFaVxQv6j9E8GkOD9h9Ja | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  46 | 藤本 あすか         | mitsuru.sato@gmail.com          | NULL              | $2y$04$YbtIh1dey6b6thBolU/az.uJ0SDkxwk55QHuxa.ERn1zcgtp8j7Ea | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  47 | 山岸 加奈           | idaka.tsubasa@gmail.com         | NULL              | $2y$04$34Hxrr.iuF72iQ0HclSwYeWrrePYgLVnl61lRNTPTmKVUdx.LD/ri | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  48 | 坂本 香織           | tkoizumi@yahoo.co.jp            | NULL              | $2y$04$LDvdJ9fez8b1Q1TFwBKVg.AS1YQmQFKJpIFMvxi63gGLW6J7sTz.6 | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  49 | 桐山 七夏           | hanako.kiriyama@tanaka.com      | NULL              | $2y$04$cE3reOpjeIoN74jJE3.XrOLPQOrBN7RtCpMoXE1n0Lyb.Uz0EG5W. | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  50 | 斉藤 さゆり         | kimura.taro@yahoo.co.jp         | NULL              | $2y$04$8cVAJwe8hN5ylva/5cfIOuchO67n.WCXIL1zts17Foj8y93ru2ECe | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  51 | 中津川 さゆり       | haruka39@ekoda.info             | NULL              | $2y$04$Uv7cj2nM/yx/XUSqvoT.6e8f6i.DRtAzZxxDGqsvwJfqbHSaY0TM6 | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  52 | 近藤 さゆり         | fujimoto.taro@nakamura.com      | NULL              | $2y$04$XGR7iB59AFNsxjGyShMxAODSmiWKonkfqC3kaxesQMyHaWxFO.xz2 | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  53 | 伊藤 修平           | gyamagishi@yahoo.co.jp          | NULL              | $2y$04$HsXgEgkFSoWcBJysC2GWS.nvJ3PGr0i2U2lQEu0eMOnoRQRxqapm. | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  54 | 笹田 稔             | akijima@yamada.com              | NULL              | $2y$04$Tz858Ay.BFnP/E.VqrHZU.sn2kgnu.6SdemDDYx/6O9OT0AcKW/RW | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  55 | 村山 陽子           | naoto85@ito.com                 | NULL              | $2y$04$fP4o6JZbAL7GkBJIJDRbZePGTbKWjvw3pGSFd08S6Gk4/zi6DtBjm | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  56 | 津田 直人           | satomi59@gmail.com              | NULL              | $2y$04$AgZaX46yOGh6tn/1jGhbhe0iXu0eME6Cuu0QwpJ5h071SAA8qWYLS | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  57 | 若松 充             | taro.sato@hotmail.co.jp         | NULL              | $2y$04$dGhbh7gQWzK0i64SBhMWWerKle5UiMvgz3dm/ESSm7WOICel43Qg. | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  58 | 浜田 結衣           | ayoshida@gmail.com              | NULL              | $2y$04$7gCKlZWVP/SaqFtOXgcWkej.apDsDHUU5mBNJ4wAzDpdkjl8onNbq | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  59 | 山口 稔             | taichi54@yahoo.co.jp            | NULL              | $2y$04$K3UNmpm9azRAPRLgsYJ8pOA0tob9ENpwmk.8DjYa/w1JI9.J.Cy6y | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  60 | 高橋 あすか         | yasuhiro.nagisa@miyazawa.org    | NULL              | $2y$04$vvrmv.9UC/ENLeQyEif3UuwOGzbLH0ieSECcA2jejpcnjZAprf70S | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  61 | 江古田 直子         | akemi10@yoshida.info            | NULL              | $2y$04$K0IW8Zltw/d40B4OGP1FYu2vdANo1PzwZSbHqYqIEuvcIfkJD8Iku | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  62 | 高橋 美加子         | mitsuru34@murayama.com          | NULL              | $2y$04$WxekSutXWEAAOAO2GGwNY.KcIE77RABQGxqTpmm.LsHaZd9wOSfO. | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  63 | 小泉 千代           | yamaguchi.minoru@mail.goo.ne.jp | NULL              | $2y$04$wKbn1Ymlqy0XL3KIINkx5et/S5BzZa2E2IX6GcM5WJ7m7XeQrywri | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  64 | 山岸 翼             | harada.haruka@yamaguchi.jp      | NULL              | $2y$04$KKXtCAgutNsEOWNRm7wasuoufqnoZHKRTGfVLFCdjq2XnhYVieAeW | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  65 | 山岸 翔太           | kijima.soutaro@tanabe.com       | NULL              | $2y$04$.pz5QQTL./FWp..JluVNde.wkC3ALM6TZbVeosOYaNQ/s1AdugQ4G | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  66 | 鈴木 充             | zito@nomura.org                 | NULL              | $2y$04$o58nnWCdY2IWvyRtTEZB5OfeBqvPT.hjxEipxNHeVazXrI6KTrHHO | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  67 | 高橋 桃子           | uno.atsushi@mail.goo.ne.jp      | NULL              | $2y$04$6F10uiFg8mgBSdVSU6WVIeHF/9tjL77ycLhkp5r4v86yrdCZ3iW4O | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  68 | 津田 千代           | yumiko.nakamura@yahoo.co.jp     | NULL              | $2y$04$hNnv3ywTsmrcUFxLUDDhwehz7EEQB32OOSO7tNaHRtAGwXEcm0CMi | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  69 | 江古田 加奈         | ssakamoto@nagisa.com            | NULL              | $2y$04$auT0wbL6sZPhAm4lGU1GY.e5E4zoeMct3k5IT33vXrhIj7.fWbFnC | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  70 | 斉藤 学             | ishida.hideki@yamagishi.jp      | NULL              | $2y$04$1RR/qWqRTQQLcRvOYcdngu.5fUOA1EmvH70lxRR.uaA2hfjlUR9Jy | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  71 | 浜田 裕太           | yui.yamagishi@hotmail.co.jp     | NULL              | $2y$04$33Ftx69dNvFymqkhQ87a2urCVCTpnAnflUXODYRQ2Bk/8qAoVYUaO | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  72 | 伊藤 裕樹           | hideki01@gmail.com              | NULL              | $2y$04$KLuImdttCbX0i5z7KsvgBO18AbxQK4EWNFcQ8vcsoZM0BRUGtXqsO | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  73 | 佐藤 裕樹           | akemi.ito@gmail.com             | NULL              | $2y$04$rB0dMFH3LN2DyTshtKf5F.8bCsmhgCe0NMqpOpGZNEVxWtjqKrlRC | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  74 | 山口 稔             | yasuhiro71@kondo.jp             | NULL              | $2y$04$KfFfIhzd8P31UMn4DoF3EeUfftkCUCDxuXFdgudVd4omzNIZp9pC. | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  75 | 加藤 涼平           | nakamura.yuta@yamada.jp         | NULL              | $2y$04$FJSjiKDBpo30NeBzxFjiauzjk4ezLIgYkaIHAWny0msDXnQIzzlyi | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  76 | 中島 桃子           | mikako.miyazawa@gmail.com       | NULL              | $2y$04$/GjZOXEIMUx/3SwSJj38He7yz9Eo2u9b8kROOnykCl1IzEENrhLmi | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  77 | 田中 さゆり         | jun63@hotmail.co.jp             | NULL              | $2y$04$2FR9Drr04bfQfgOEC2lnYeQTtFrPeCNbDOvRGCk9eP1yBDBg7KVJm | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  78 | 井上 智也           | yuki.sasaki@yahoo.co.jp         | NULL              | $2y$04$mMz2Mdo.VkHRrfSbUPDL9epZZyGlayC/e.wlZApbme9cABXcYnBHS | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  79 | 高橋 修平           | takuma.aoyama@hotmail.co.jp     | NULL              | $2y$04$dvzg6SQHn0pcQQOL0amMje8kQmGgKMKKVVfp3.P4ryZsvqaPDBz/O | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  80 | 若松 花子           | kyosuke80@saito.org             | NULL              | $2y$04$NGAR7ZD1KgOQ8m0pBuJXkONUaKtaN8dMi/y8062UaFCxu4SuJTnJq | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  81 | 笹田 里佳           | yamagishi.kana@kijima.org       | NULL              | $2y$04$55ABNqAvsZ03ldCm.21rSeU9COUqfFb4zbx7W/RH9HcM/.43/elEW | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  82 | 工藤 亮介           | vogaki@sato.info                | NULL              | $2y$04$5FFKxi/RamHdfyHEu8fFfOJfFMIfcYFB14jYtr9S/gUPas..vc7.S | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  83 | 田中 健一           | mitsuru79@gmail.com             | NULL              | $2y$04$ELs.EerwDfEhhsNVnDq3h.jk4AA/cbSz727.ESxvYPtdr61XxkJv6 | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  84 | 鈴木 浩             | tomoya68@nagisa.jp              | NULL              | $2y$04$TSkqboSWm4cOD1OWy5vmGu9GthCPtrfzV5UI12.KCq2sJGSmFy1Wu | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  85 | 木村 春香           | gyamamoto@yahoo.co.jp           | NULL              | $2y$04$oW0/XjgETZUgUKaGfDZiC.Ujfa8K8c2nv21uzbsufcA/dLOh3Re5S | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  86 | 浜田 篤司           | naoki.harada@nakamura.org       | NULL              | $2y$04$uYFekJp1/i3UR61dAWB6ve5bUAodtnMjmvOCyF02mGLE4LdLgC04O | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  87 | 山本 桃子           | kana95@miyake.com               | NULL              | $2y$04$gDwoiNDxdfTiVqX4YO2cF.5NCS09PvTsJxwCPfrQjebSF6E6tUwEy | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  88 | 中村 太一           | yumiko.yamagishi@mail.goo.ne.jp | NULL              | $2y$04$ktW7H9dHQbYFRFoT5nssquK3qnBjlQUsnbS7ZsqomLYfN2T65JCoW | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  89 | 三宅 太郎           | atsushi.kijima@ogaki.com        | NULL              | $2y$04$cZRi6t76z9TX1UzRJeSHO.H0GbsRydvYd2LTE/oqRmJR9e83QGsMy | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  90 | 小林 浩             | nakajima.manabu@gmail.com       | NULL              | $2y$04$BxD2N7AtwDiuJ824/HQka.c1QjrZoms/wjjvDwCBgRj30sw7bm722 | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  91 | 野村 翼             | tanabe.naoki@hotmail.co.jp      | NULL              | $2y$04$8nw3NKsysjg7d29WcDbJK.vYBVxtPWVgwnqIfokTpuVhqPZAoB5iC | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  92 | 原田 加奈           | naoko.kimura@tanaka.jp          | NULL              | $2y$04$0CmeFZ9rGIvJJcmvsHx9We2r4.7gb3HdG3nQdgaLxaY6rVOTiJ0bO | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  93 | 吉田 さゆり         | ouno@suzuki.net                 | NULL              | $2y$04$E/JVnr7rGF9HydEOmtBfsu4NHTpnlqJsQP/hAPjn56tDexfguwR3y | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  94 | 笹田 真綾           | soutaro52@gmail.com             | NULL              | $2y$04$x/vTHK83CQQYbUiX5MttXO6PCb12psdyYwx0NWU595IJWN2Ww2452 | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  95 | 小泉 拓真           | sayuri14@nakajima.biz           | NULL              | $2y$04$8nL89oZ2V.kvYpfm4uoIE.sUCDWDmLAHZZwLHPRyZtMliudhWtFBu | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  96 | 吉本 京助           | takuma54@yahoo.co.jp            | NULL              | $2y$04$p2pjwaIRCSR.ugu.TPGJD.f.r6.xC2pMFG24u2WqV/XJQlrEZJ51. | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  97 | 藤本 香織           | hsasada@gmail.com               | NULL              | $2y$04$ozm0FWnX8IMX2XQWVXuTh.9e7UNrfMwSOM0eBdkAgSPP8kiIT.xtq | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  98 | 鈴木 桃子           | hanako.wakamatsu@hotmail.co.jp  | NULL              | $2y$04$LdHNu5CSWLBt7yxdJkqMwuqDrLxIVrqnTPjY1p2O72QOoODqx3i0C | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
|  99 | 吉本 美加子         | miyazawa.kazuya@tanabe.info     | NULL              | $2y$04$88Lh7lxPPIzmoP/EmZe0A.x2v0vR6QVrh193kFr3tK1k7zyDv.LIW | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
| 100 | 喜嶋 春香           | maaya84@mail.goo.ne.jp          | NULL              | $2y$04$mNOVyL5KsgG47N7OckRFK.DXs/ctebAVHbNhUonUWKiTkRg0kcxra | NULL           | 2022-01-06 12:11:24 | 2022-01-06 12:11:24 |
+-----+---------------------+---------------------------------+-------------------+--------------------------------------------------------------+----------------+---------------------+---------------------+
100 rows in set (0.00 sec)
```

## 8. ユーザーの削除が成功するかのテスト
#### tests/Unit/UserTest.phpに以下のメソッドを追記
```
    /**
     * ユーザー削除テスト
     *
     * @return void
     */
    public function test_ユーザ削除(){
        // 最初のユーザーを取得
        $user = User::first();
        // ユーザーが存在していれば
        if($user !== null){
            // 現在の全ユーザー数を取得
            $count_before = count(User::all());
            // 最初のユーザーを削除
            $user->delete();
            // 削除後の全ユーザー数を取得
            $count_after = count(User::all());
            // 削除前後で全ユーザー数が1だけ減ったか検証
            $this->assertSame(($count_before - 1), $count_after);
        }else{
            // 最初のユーザーが存在しない検証
            $this->assertNull($user);
        }
    }
```

ユニットテストの実行
```
vendor/bin/phpunit tests/Unit/UserTest.php --filter test_ユーザ削除
PHPUnit 7.5.20 by Sebastian Bergmann and contributors.

.                                                                   1 / 1 (100%)

Time: 135 ms, Memory: 18.00 MB

OK (1 test, 1 assertion)
```

最後に以下の行のコメントアウトを取っておく
```
    // テストが終わったらテーブルをリフレッシュする設定
    use RefreshDatabase;
```

## 9. Featureディレクトリに新規ユーザー登録機能をテストするテストケースを作成
```
php artisan make:test RegisterControllerTest
```
#### tests/Feature/RegisterControllerTest.php の内容確認
```
<?php

namespace Tests\Feature;

use Tests\TestCase;
use Illuminate\Foundation\Testing\WithFaker;
use Illuminate\Foundation\Testing\RefreshDatabase;

class RegisterControllerTest extends TestCase
{
    /**
     * A basic feature test example.
     *
     * @return void
     */
    public function testExample()
    {
        $response = $this->get('/');

        $response->assertStatus(200);
    }
}
```

このテストファイルだけを実行
```
vendor/bin/phpunit tests/Feature/RegisterControllerTest.php
PHPUnit 7.5.20 by Sebastian Bergmann and contributors.

.                                                                   1 / 1 (100%)

Time: 229 ms, Memory: 18.00 MB

OK (1 test, 1 assertion)
```

#### tests/Feature/RegisterControllerTest.phpを以下のように書き換え
```
<?php

namespace Tests\Feature;

use Tests\TestCase;
use Illuminate\Foundation\Testing\WithFaker;
use Illuminate\Foundation\Testing\RefreshDatabase;
use Illuminate\Foundation\Testing\DatabaseMigrations; // 追加
use Faker\Factory; // 追加

class RegisterControllerTest extends TestCase
{
    // 前のテストデータが、それに引き続くテストへ影響をあたえないように、各テストが終了するごとにデータベースを破棄する
    // use DatabaseMigrations; // 追加
    // テストが終わったらテーブルの情報を削除する設定
    use RefreshDatabase;
    
    /**
     * 複数のテストで使用するような値を事前に定義
     *
     * @return void
     */
    public function setUp() :void
    {
        parent::setUp();
        // faker を初期化
        $this->faker = Factory::create('ja_JP');
    }
    
    
    /**
     * ユーザー登録画面のURLにアクセスしてユーザー登録画面が表示されるかテスト
     *
     * @return void
     */
    public function test_ユーザー登録画面のURLにアクセスしてユーザー登録画面が表示される()
    {
        // RegisterController@showRegistrationForm にアクセス
        $response = $this->get('/signup');
        // resources/views/authフォルダのregister.blade.phpが表示されるかチェック
        $response->assertViewIs('auth.register');
    }
    
    /**
     * ユーザー登録に成功した後はトップ画面が表示されるかテスト
     *
     * @return void
     */
    public function test_ユーザー登録に成功した後はトップ画面が表示される()
    {
        // fakerでパスワード作成
        $password = bcrypt($this->faker->password);
        // RegisterController@registerにダミーユーザー情報を引き連れてアクセスする
        $response = $this->post('/signup', [
            'name'     => $this->faker->name,
            'email'     => $this->faker->unique()->email,
            'password' => $password,
            'password_confirmation' => $password
        ]);
        // ユーザー登録後に /top にリダイレクトされているかのチェック
        $response->assertRedirect('/top');
    }
    
    /**
     * ログインしていない場合はログイン後のトップ画面のURLにアクセスするとログイン画面にリダイレクトされるかテスト
     *
     * @return void
     */
    public function test_ログインしていない場合はログイン後のトップ画面のURLにアクセスするとログイン画面にリダイレクトされる()
    {
        $response = $this->get('/top');
        $response->assertRedirect('/login');
    }
    
    /**
     * 名前を入力しないで登録しようとするとエラーメッセージが表示されるかテスト
     *
     * @return void
     */
    public function test_名前を入力しないで登録しようとするとエラーメッセージが表示される()
    {
        // RegisterController@registerにダミーユーザー情報を引き連れてアクセスする
        // ただし名前は未入力
        $response = $this->post('/signup', [
            'name'  => '',
            'email'    => 'test@example.com',
            'password'  => 'password123',
            'password_confirmation' => 'password123'
        ]);
        // 名前が入力されていない場合に表示されるvalidationメッセージの期待値
        $errorMessage = 'The name field is required.';
        // RegisterController@showRegistrationForm にアクセスし期待されるvalidationメッセージが得られるかされるかチェック
        $this->get('/signup')->assertSee($errorMessage);
    }
    
    /**
     * メールアドレスを入力しないで登録しようとするとエラーメッセージが表示されるかテスト
     *
     * @return void
     */
    public function test_メールアドレスを入力しないで登録しようとするとエラーメッセージが表示される()
    {
        // RegisterController@registerにダミーユーザー情報を引き連れてアクセスする
        // ただしメールアドレスは未入力
        $response = $this->post('/signup', [
            'name'  => 'testuser',
            'email'    => '',
            'password'  => 'password123',
            'password_confirmation' => 'password123'
        ]);
        // メールアドレスが入力されていない場合に表示されるvalidationメッセージの期待値
        $errorMessage = 'The email field is required.';
        // RegisterController@showRegistrationForm にアクセスし期待されるvalidationメッセージが表示されるかチェック
        $this->get('/signup')->assertSee($errorMessage);
    }
    
    /**
     * パスワードを入力しないで登録しようとするとエラーメッセージが表示されるかテスト
     *
     * @return void
     */
    public function test_パスワードを入力しないで登録しようとするとエラーメッセージが表示される()
    {
        // RegisterController@registerにダミーユーザー情報を引き連れてアクセスする
        // ただしパスワードは未入力
        $response = $this->post('/signup', [
            'name'  => 'testuser',
            'email'    => 'test@example.com',
            'password'  => '',
            'password_confirmation'  => ''
        ]);
        // パスワードが入力されていない場合に表示されるvalidationメッセージの期待値
        $errorMessage = 'The password field is required.';
        // RegisterController@showRegistrationForm にアクセスし期待されるvalidationメッセージが表示されるかチェック
        $this->get('/signup')->assertSee($errorMessage);
    }
 
     /**
     * パスワードを5文字未満で登録しようとするとエラーメッセージが表示されるかテスト
     *
     * @return void
     */
    public function test_パスワードを5文字未満で登録しようとするとエラーメッセージが表示される()
    {
        // RegisterController@registerにダミーユーザー情報を引き連れてアクセスする
        // ただしパスワードは5文字未満
        $response = $this->post('/signup', [
            'name'  => 'testuser',
            'email'    => 'test@example.com',
            'password'  => 'a',
            'password_confirmation'  => 'a'
        ]);
        // パスワードが5文字未満の場合に表示されるvalidationメッセージの期待値
        $errorMessage = 'The password must be at least 5 characters.';
        // RegisterController@showRegistrationForm にアクセスし期待されるvalidationメッセージが表示されるかチェック
        $this->get('/signup')->assertSee($errorMessage);
    }
    
    /**
     * 2つのパスワードが違う状態で登録しようとするとエラーメッセージが表示されるかテスト
     *
     * @return void
     */
    public function test_2つのパスワードが違う状態で登録しようとするとエラーメッセージが表示される()
    {
        // RegisterController@registerにダミーユーザー情報を引き連れてアクセスする
        // ただし2つのパスワードが異なる
        $response = $this->post('/signup', [
            'name'  => 'testuser',
            'email'    => 'test@example.com',
            'password'  => 'aaaaa',
            'password_confirmation'  => 'aaaab'
        ]);
        // 2つのパスワードが異なる場合に表示されるvalidationメッセージの期待値
        $errorMessage = 'The password confirmation does not match.';
        // RegisterController@showRegistrationForm にアクセスし期待されるvalidationメッセージが表示されるかチェック
        $this->get('/signup')->assertSee($errorMessage);
    }
}

```

このファイルのテストを実行
```
vendor/bin/phpunit tests/Feature/RegisterControllerTest.php
PHPUnit 7.5.20 by Sebastian Bergmann and contributors.

........                                                            8 / 8 (100%)

Time: 383 ms, Memory: 26.00 MB

OK (8 tests, 10 assertions)
```

## 10. Featureディレクトリにログイン機能をテストするテストケースを作成
```
php artisan make:test LoginControllerTest
```
#### tests/Feature/LoginControllerTest.php.php の内容を以下に書き換え
```
<?php

namespace Tests\Feature;

use Tests\TestCase;
use Illuminate\Foundation\Testing\WithFaker;
use Illuminate\Foundation\Testing\RefreshDatabase;
use Illuminate\Foundation\Testing\DatabaseMigrations; // 追加
use Faker\Factory; // 追加
use App\User; // 追加

class LoginControllerTest extends TestCase
{
    
    // 前のテストデータが、それに引き続くテストへ影響をあたえないように、各テストが終了するごとにデータベースを破棄する
    // use DatabaseMigrations; // 追加
    // テストが終わったらテーブルの情報を削除する設定
    use RefreshDatabase;
    
    /**
     * 複数のテストで使用するような値を事前に定義
     *
     * @return void
     */
    public function setUp() :void
    {
        parent::setUp();
        // faker を初期化
        $this->faker = Factory::create('ja_JP');
    }

    
    /** @test */
    public function ログイン画面のURLにアクセスして画面が表示される()
    {
        // LoginController@showLoginForm にアクセス
        $response = $this->get('/login');
        // 正常に到達できるかチェック
        $response->assertStatus(200);
    }
    
    /** @test */
    public function ログイン画面のURLにアクセスしてログイン画面が表示される()
    {
        // LoginController@showLoginForm にアクセス
        $response = $this->get('/login');
        // resources/views/auth フォルダの中にある login.blade.phpが表示されるかのチェック
        $response->assertViewIs('auth.login');
    }
    
    /** @test */
    public function 登録しておいたemailアドレスとパスワードでログインできる()
    {
        // fakerを使ってダミー情報作成
        $email = $this->faker->unique()->email;
        $password = $this->faker->password;
        
        // factoryを使ってダミーユーザー作成
        // メールアドレス、パスワード以外は勝手に自動生成してくれる
        $user = factory(User::class)->create([
            'email' => $email,
            'password'  => bcrypt($password)
        ]);
        
        // その情報でログイン処理
        $response = $this->post('/login', [
            'email'    => $email,
            'password'  => $password
        ]);
        
        // そのダミーユーザー情報で認証されるかチェック
        $this->assertAuthenticatedAs($user);
    }
    
    /** @test */
    public function ログインに成功した後はトップ画面が表示される()
    {
        // fakerを使ってダミー情報作成
        $email = $this->faker->unique()->email;
        $password = $this->faker->password;
        
        // factoryを使ってダミーユーザー作成
        // メールアドレス、パスワード以外は勝手に自動生成してくれる
        $user = factory(User::class)->create([
            'email' => $email,
            'password'  => bcrypt($password)
        ]);
        
        // その情報でログイン処理
        $response = $this->post('/login', [
            'email'    => $email,
            'password'  => $password
        ]);
        // Top画面にリダイレクトされるかチェック
        $response->assertRedirect('/top');
    }

    /** @test */
    public function 登録したのと違うメールアドレスでログインしようとしてもログインできない()
    {
        // fakerを使ってダミー情報作成
        $email = $this->faker->unique()->email;
        $password = $this->faker->password;
        
        // factoryを使ってダミーユーザー作成
        // メールアドレス、パスワード以外は勝手に自動生成してくれる
        $user = factory(User::class)->create([
            'email' => $email,
            'password'  => bcrypt($password)
        ]);
        
        // 間違った情報でログイン処理
        $response = $this->post('/login', [
            'email'    => $email . 'a',
            'password'  => $password
        ]);
        
        // ユーザーが認証されていないかテスト
        $this->assertGuest();
    }

    /** @test */
    public function 登録したのと違うパスワードでログインしようとしてもログインできない()
    {
        // fakerを使ってダミー情報作成
        $email = $this->faker->unique()->email;
        $password = $this->faker->password;
        
        // factoryを使ってダミーユーザー作成
        // メールアドレス、パスワード以外は勝手に自動生成してくれる
        $user = factory(User::class)->create([
            'email' => $email,
            'password'  => bcrypt($password)
        ]);
        
        // 間違った情報でログイン処理
        $response = $this->post('/login', [
            'email'    => $email,
            'password'  => $password . 'a'
        ]);
        
        // ユーザーが認証されていないかテスト
        $this->assertGuest();
    }
    
    /** @test */
    public function 異なるアドレスでログインしようとするとエラーメッセージが表示される()
    {
        // fakerを使ってダミー情報作成
        $email = $this->faker->unique()->email;
        $password = $this->faker->password;
        
        // factoryを使ってダミーユーザー作成
        // メールアドレス、パスワード以外は勝手に自動生成してくれる
        $user = factory(User::class)->create([
            'email' => $email,
            'password'  => bcrypt($password)
        ]);
        
        // 間違ったメールアドレスでログイン        
        $response = $this->post('/login', [
            'email'    => $email . 'a',
            'password'  => $password
        ]);
        
        // メールアドレスを間違えた際の期待されるvalidationメッセージ
        $errorMessage = 'These credentials do not match our records.';
        // LoginController@showLoginForm にアクセスしてこのエラーメッセージが得られるかチェック
        $this->get('/login')->assertSee($errorMessage);
    }
    
    /** @test */
    public function 異なるパスワードでログインしようとするとエラーメッセージが表示される()
    {
        // fakerを使ってダミー情報作成
        $email = $this->faker->unique()->email;
        $password = $this->faker->password;
        
        // factoryを使ってダミーユーザー作成
        // メールアドレス、パスワード以外は勝手に自動生成してくれる
        $user = factory(User::class)->create([
            'email' => $email,
            'password'  => bcrypt($password)
        ]);
        
        // 異なるパスワードを送ってログイン
        $response = $this->post('/login', [
            'email'    => $email,
            'password'  => $password . 'a'
        ]);
        // パスワードを間違えた際の期待されるvalidationメッセージ
        $errorMessage = 'These credentials do not match our records.';
        // LoginController@showLoginForm にアクセスしてこのエラーメッセージが得られるかチェック
        $this->get('/login')->assertSee($errorMessage);
    }
    
    /** @test */
    public function ログアウトすると認証状態が解除される()
    {
        // factoryを使ってダミーユーザー作成
        $user = factory(User::class)->create();
        // そのユーザーを認証状態にセット
        $this->actingAs($user);
        // そのユーザー情報で認証されるているかチェック
        $this->assertAuthenticatedAs($user);
        // ログアウトリクエストを送る
        $response = $this->get('/logout');
        // ユーザーが認証されていない
        $this->assertGuest();
    }
    
    /** @test */
    public function ログアウトをするとログイン前の画面のリダイレクトする()
    {
        // factoryを使ってダミーユーザー作成
        $user = factory(User::class)->create();
        // そのユーザーを認証状態にセット
        $this->actingAs($user);
        // ログアウトリクエストを送る
        $response = $this->get('/logout');
        // ログアウトした画面にリダイレクトするかチェック
        $response->assertRedirect('/');
    }

}

```

このテストファイルだけを実行
```
vendor/bin/phpunit tests/Feature/LoginControllerTest.php
PHPUnit 7.5.20 by Sebastian Bergmann and contributors.

..........                                                        10 / 10 (100%)

Time: 446 ms, Memory: 26.00 MB

OK (10 tests, 17 assertions)
```

## 11. Git/Github

```
git add .
git commit -m "ユーザー関連テスト完了"
git log
git push origin main
```

